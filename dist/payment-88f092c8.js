"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[899],{43935:(e,t,n)=>{n.r(t),n.d(t,{default:()=>me,mapToPaymentProps:()=>ue});var a=n(31635),r=n(84278),i=n(93564),o=n(30455),d=n(68512),s=n(17080),l=n(2398),c=n(45293),u=n(89792);var m=n(72889),p=n(79001),y=n(77546),h=n(49655),_=n(48447),v=n(37958),f=n(64399),g=n(22375),b=n(60833),E=n(43586),C=n(72769),S=n(46487),A=n(92909),P=n(91589);const w=function(e){var t=e.children,n=e.body,r=e.header,i=(0,o.useCallback)((function(e){return o.createElement(A.A,(0,a.__assign)({},e,{additionalBodyClassName:"modal--withText",footer:o.createElement(S.Ay,{onClick:e.onRequestClose,size:S.Mp.Small},o.createElement(h.A,{id:"common.ok_action"})),header:r,shouldShowCloseButton:!0}),n)}),[r,n]);return o.createElement(P.A,{modal:i},(function(e){var n=e.onClick;return o.createElement("a",{onClick:(0,C.A)(n)},t)}))};var k=n(58330);const M=function(e){var t=e.children;return o.createElement(o.Fragment,null,t.split("\n").map((function(e,t){return o.createElement(o.Fragment,{key:t},e,o.createElement("br",null))})))};var x;!function(e){e.Link="link",e.TextArea="textarea",e.Modal="modal"}(x||(x={}));var T=(0,d.A)((function(e){var t=e.language,n=e.name,a=e.terms,r=t.translate("terms_and_conditions.agreement_with_link_text",{url:""}),i=(0,y.A)(r),d=i?o.createElement(o.Fragment,null,i[0],o.createElement(w,{body:o.createElement(M,null,a),header:o.createElement(k.A,null,o.createElement(h.A,{id:"terms_and_conditions.heading"}))},i[1]),i[2]):r;return o.createElement(v.A,{labelContent:d,name:n})})),O=function(e){var t=e.name,n=e.url,a=(0,o.useMemo)((function(){return n?o.createElement(_.A,{data:{url:n},id:"terms_and_conditions.agreement_with_link_text"}):o.createElement(h.A,{id:"terms_and_conditions.agreement_text"})}),[n]);return o.createElement(v.A,{labelContent:a,name:t})},z=function(e){var t=e.name,n=e.terms,a=(0,o.useCallback)((function(e){var t=e.field;return o.createElement(f.A,{defaultValue:n,name:t.name,readOnly:!0})}),[n]);return o.createElement(g.A,{input:a,name:"".concat(t,"Text")})};const N=(0,o.memo)((function(e){var t=e.type;return o.createElement(b.A,{additionalClassName:"checkout-terms",legend:o.createElement(E.A,null,o.createElement(h.A,{id:"terms_and_conditions.terms_and_conditions_heading"}))},function(e){return e.type===x.TextArea}(e)&&o.createElement(z,(0,a.__assign)({},e)),function(e){return e.type===x.Modal}(e)&&t===x.Modal?o.createElement(T,(0,a.__assign)({},e)):o.createElement(O,(0,a.__assign)({},e)))}));function I(e,t,n){switch(e.type){case"not_initialized":return t("payment.payment_error");case"custom_provider_execute_error":return t(e.subtype);case"payment_cancelled":return t("payment.payment_cancelled");case"payment_method_invalid":return t("payment.payment_method_disabled_error");case"tax_provider_unavailable":return t("payment.tax_provider_unavailable");case"cart_changed":return t("shipping.cart_change_error");case"cart_consistency":return t("cart.consistency_error");default:return(0,i.includes)(["order_could_not_be_finalized_error","provider_fatal_error","payment_invalid","provider_error","provider_widget_error","user_payment_error"],e.body&&e.body.type)?t("payment.payment_method_error",{message:e.message}):n&&e.body&&e.body.errors&&e.body.errors.length?e.body.errors.map((function(e){return t("payment.errors.".concat(e.code))})).join(" "):e.message?e.message:"unrecoverable"===e.type?t("common.unavailable_error"):t("payment.place_order_error")}}function D(e,t){return"unrecoverable"===e.type?t("common.unavailable_heading"):t("common.error_heading")}function R(e){var t=e.split(new RegExp("\\s*".concat("/","\\s*"))),n=t[0],a=void 0===n?"":n,r=t[1],i=void 0===r?"":r;return/^\d+$/.test(a)&&/^\d+$/.test(i)?{month:1===a.length?"0".concat(a):a.slice(0,2),year:2===i.length?"20".concat(i):i.slice(0,4)}:{month:"",year:""}}var B=n(78713);function q(e,t){return(0,i.compact)([t,e]).join("-")}function U(e){return e instanceof Object&&"ccNumber"in e}function L(e){return e instanceof Object&&"ccExpiry"in e}function V(e,t){if(!t)return{};var n,r,o=e.paymentProviderRadio,d=(0,a.__rest)(e,["paymentProviderRadio"]),s=function(e){var t=e.indexOf("-")>-1?e.split("-"):[void 0,e];return{gatewayId:t[0],methodId:t[1]}}(o),l=s.methodId,c={payment:{gatewayId:s.gatewayId,methodId:l}},u=(0,i.omitBy)((0,a.__assign)((0,a.__assign)({},d),{ccExpiry:L(e)?R(e.ccExpiry):null,ccNumber:U(e)?(n=e.ccNumber,void 0===r&&(r=" "),(0,B.number)(n).card?n.replace(new RegExp(r,"g"),""):n):null}),i.isNil);return c.payment&&!(0,i.isEmpty)(u)&&(c.payment.paymentData=u),c}const F=(0,o.createContext)(void 0);var H=n(71055),G=function(e){var t=e.termsConditionsUrl,n=e.termsConditionsText,a=void 0===n?"":n;return o.createElement(o.Fragment,null,t?o.createElement(N,{name:"terms",type:x.Link,url:t}):o.createElement(N,{name:"terms",terms:a,type:x.TextArea}))},Y=n(4899),K=n(46522);function j(e){var t=e.additionalValidation,n=e.isTermsConditionsRequired,a=e.language,r={paymentProviderRadio:(0,K.Yj)().required()},i=(0,K.Ik)(r).concat(function(e){var t=e.isTermsConditionsRequired,n=e.language,a={};return t&&(a.terms=(0,K.zM)().oneOf([!0],n.translate("terms_and_conditions.agreement_required_error"))),(0,K.Ik)(a)}({isTermsConditionsRequired:n,language:a}));return t?i.concat(t):i}var W,J=n(98610);!function(e){e.ApplePay="applepay",e.Barclaycard="barclaycard",e.CreditCard="credit-card",e.GooglePay="googlepay",e.PayWithGoogle="paywithgoogle",e.Masterpass="masterpass",e.MultiOption="multi-option",e.Paypal="paypal",e.PaypalCredit="paypal-credit",e.PaypalVenmo="paypal-venmo",e.VisaCheckout="visa-checkout"}(W||(W={}));const Q=W;function Z(e){return function(t){var n=function(e){return function(t){var n,a=((n={})[J.A.Affirm]=e.translate("payment.affirm_name_text"),n[J.A.Afterpay]=e.translate("payment.afterpay_name_text"),n[J.A.AmazonPay]=e.translate("payment.amazon_name_text"),n[J.A.Bolt]=e.translate("payment.bolt_name_text"),n[J.A.Clearpay]=e.translate("payment.clearpay_name_text"),n[Q.GooglePay]=e.translate("payment.google_pay_name_text"),n[J.A.Klarna]=e.translate("payment.klarna_name_text"),n[Q.Paypal]=e.translate("payment.paypal_name_text"),n[Q.PaypalCredit]=e.translate("payment.paypal_credit_name_text"),n[Q.VisaCheckout]=e.translate("payment.vco_name_text"),n);return a[t.id]||a[t.method]}}(e)(t);return n&&t.method!==Q.MultiOption||(n=t.config&&t.config.displayName),n||(n=(0,i.capitalize)((0,i.get)(t,"initializationData.paymentData.cardData.digital_wallet_type")||t.method||t.id)),n}}var $=n(8284),X=[J.A.Bolt],ee=(0,o.memo)((function(e){var t=e.methodId,n=e.methodName,a=e.methodType,r=e.methodGateway,i=e.initialisationStrategyType,d=e.brandName,s=e.isComplete;if(!e.isPaymentDataRequired)return o.createElement(h.A,{id:"payment.place_order_action"});if(n&&"none"===i)return o.createElement(h.A,{data:{methodName:n},id:"payment.ppsdk_continue_action"});if(t===J.A.AmazonPay)return o.createElement(h.A,{id:"payment.amazonpay_continue_action"});if(t===J.A.Bolt)return o.createElement(o.Fragment,null,o.createElement($.A,{additionalClassName:"payment-submit-button-bolt-icon"}),o.createElement(h.A,{id:"payment.place_order_action"}));if(r===J.A.Barclaycard)return o.createElement(h.A,{id:"payment.barclaycard_continue_action"});if(r===J.A.BlueSnapV2)return o.createElement(h.A,{id:"payment.bluesnap_v2_continue_action"});if(a===Q.VisaCheckout)return o.createElement(h.A,{id:"payment.visa_checkout_continue_action"});if(a===Q.PaypalVenmo||t===J.A.BraintreeVenmo)return o.createElement(h.A,{id:"payment.paypal_venmo_continue_action"});if(a===Q.Paypal){var l=t===J.A.PaypalCommerce?"payment.place_order_action":"payment.paypal_continue_action";return o.createElement(h.A,{data:{isComplete:s},id:s?"payment.paypal_complete_action":l})}if(a===Q.PaypalCredit){var c=d?"payment.continue_with_brand":"payment.paypal_pay_later_continue_action",u=d?"payment.complete_with_brand":"payment.paypal_pay_later_complete_action";return o.createElement(h.A,{data:{brandName:d,isComplete:s,continueTranslationId:c,completeTranslationId:u},id:s?u:c})}return t===J.A.Opy?o.createElement(h.A,{data:{methodName:n},id:"payment.opy_continue_action"}):t===J.A.Quadpay?o.createElement(h.A,{id:"payment.quadpay_continue_action"}):t===J.A.Zip?o.createElement(h.A,{id:"payment.zip_continue_action"}):t===J.A.Klarna?o.createElement(h.A,{id:"payment.klarna_continue_action"}):o.createElement(h.A,{id:"payment.place_order_action"})}));const te=(0,c.A)((function(e){var t=e.checkoutState,n=t.data.isPaymentDataRequired,a=t.statuses,r=a.isInitializingCustomer,i=a.isInitializingPayment,o=a.isSubmittingOrder;return{isInitializing:r()||i(),isPaymentDataRequired:n(),isSubmitting:o()}}))((0,o.memo)((function(e){var t=e.isDisabled,n=e.isInitializing,a=e.isSubmitting,r=e.isPaymentDataRequired,i=e.methodGateway,d=e.methodId,s=e.methodName,l=e.methodType,c=e.initialisationStrategyType,u=e.brandName,m=e.isComplete;return o.createElement(S.Ay,{className:X.includes(d)?"payment-submit-button-".concat(d):void 0,"data-test":"payment-submit-button",disabled:n||a||t,id:"checkout-payment-continue",isFullWidth:!0,isLoading:a,size:S.Mp.Large,type:"submit",variant:S.Ak.Action},o.createElement(ee,{brandName:u,initialisationStrategyType:c,isComplete:m,isPaymentDataRequired:r,methodGateway:i,methodId:d,methodName:s,methodType:l}))})));var ne=n(13461);var ae=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={shouldShowRetryButton:!1},t.handleRetry=function(e){e.preventDefault(),t.verify()},t}return(0,a.__extends)(t,e),t.prototype.componentDidMount=function(){return(0,a.__awaiter)(this,void 0,void 0,(function(){return(0,a.__generator)(this,(function(e){return this.props.didExceedSpamLimit||this.verify(),[2]}))}))},t.prototype.render=function(){var e=this.props.isExecutingSpamCheck;return o.createElement("div",{className:"spamProtection-container"},o.createElement(ne.A,{isLoading:e},this.renderContent()))},t.prototype.renderContent=function(){var e=this.props.didExceedSpamLimit,t=this.state.shouldShowRetryButton;if(e||t)return o.createElement("div",{className:"spamProtection-panel optimizedCheckout-overlay"},o.createElement("a",{className:"spamProtection-panel-message optimizedCheckout-primaryContent","data-test":"spam-protection-verify-button",onClick:this.handleRetry},o.createElement(h.A,{id:"spam_protection.verify_action"})))},t.prototype.verify=function(){return(0,a.__awaiter)(this,void 0,void 0,(function(){var e,t,n,r,o;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:e=this.props,t=e.executeSpamCheck,n=e.onUnhandledError,r=void 0===n?i.noop:n,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,t()];case 2:return a.sent(),[3,4];case 3:return o=a.sent(),this.setState({shouldShowRetryButton:!0}),(0,u.A)(o)&&"spam_protection_challenge_not_completed"!==o.type&&r(o),[3,4];case 4:return[2]}}))}))},t}(o.Component);const re=(0,c.A)((function(e){var t=e.checkoutService;return{isExecutingSpamCheck:e.checkoutState.statuses.isExecutingSpamCheck(),executeSpamCheck:t.executeSpamCheck}}))(ae);var ie=function(){return o.createElement("div",{className:"submitButtonContainer",id:"checkout-payment-continue"})},oe={mapPropsToValues:function(e){var t=e.defaultGatewayId;return{ccCustomerCode:"",ccCvv:"",ccDocument:"",customerEmail:"",customerMobile:"",ccExpiry:"",ccName:"",ccNumber:"",paymentProviderRadio:q(e.defaultMethodId,t),instrumentId:"",shouldCreateAccount:!0,shouldSaveInstrument:!1,terms:!1,hostedForm:{cardType:"",errors:{cardCode:"",cardCodeVerification:"",cardExpiry:"",cardName:"",cardNumber:"",cardNumberVerification:""}},accountNumber:"",routingNumber:""}},handleSubmit:function(e,t){var n=t.props.onSubmit;(void 0===n?i.noop:n)((0,i.omitBy)(e,(function(e,t){return(0,i.isNil)(e)||""===e||"hostedForm"===t})))},validationSchema:function(e){var t=e.language,n=e.isTermsConditionsRequired,a=void 0!==n&&n;return j({additionalValidation:e.validationSchema,isTermsConditionsRequired:a,language:t})}};const de=(0,d.A)((0,H.withFormik)(oe)((0,o.memo)((function(e){var t,n,a=e.didExceedSpamLimit,r=e.isTermsConditionsRequired,i=e.language,d=e.onUnhandledError,s=e.selectedMethod,l=e.shouldDisableSubmit,c=e.shouldHidePaymentSubmitButton,u=e.shouldExecuteSpamCheck,m=e.termsConditionsText,p=void 0===m?"":m,y=e.termsConditionsUrl,h=(0,o.useMemo)((function(){if(s){if(s.id===J.A.AmazonPay){if(s.initializationData.paymentToken)return;return s.id}return s.id}}),[s]),_=(0,o.useMemo)((function(){var e,t,n;if(s)return(null===(t=null===(e=s.initializationData)||void 0===e?void 0:e.payPalCreditProductBrandName)||void 0===t?void 0:t.credit)||(null===(n=s.initializationData)||void 0===n?void 0:n.payPalCreditProductBrandName)}),[s]);return u?o.createElement(re,{didExceedSpamLimit:a,onUnhandledError:d}):o.createElement(Y.A,{className:"checkout-form",testId:"payment-form"},r&&o.createElement(G,{termsConditionsText:p,termsConditionsUrl:y}),o.createElement("div",{className:"form-actions"},o.createElement("div",{className:"optimizedCheckout-callToAction"},"Once a request is submitted, a SmallSat Catalog sales engineer will contact you with information, questions, or quotes within 2 to 3 business days."),c?o.createElement(ie,null):o.createElement(te,{brandName:_,initialisationStrategyType:s&&(null===(t=s.initializationStrategy)||void 0===t?void 0:t.type),isComplete:!!(null===(n=null==s?void 0:s.initializationData)||void 0===n?void 0:n.isComplete),isDisabled:l,methodGateway:s&&s.gateway,methodId:h,methodName:s&&Z(i)(s),methodType:s&&s.method})))}))));var se;!function(e){e.Api="PAYMENT_TYPE_API",e.Hosted="PAYMENT_TYPE_HOSTED",e.Offline="PAYMENT_TYPE_OFFLINE",e.PPSDK="PAYMENT_TYPE_SDK"}(se||(se={}));const le=se;var ce=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={didExceedSpamLimit:!1,isReady:!1,shouldDisableSubmit:{},shouldHidePaymentSubmitButton:{},validationSchemas:{},submitFunctions:{}},t.getContextValue=(0,r.memoizeOne)((function(){return{disableSubmit:t.disableSubmit,setSubmit:t.setSubmit,setValidationSchema:t.setValidationSchema,hidePaymentSubmitButton:t.hidePaymentSubmitButton}})),t.disableSubmit=function(e,n){var r;void 0===n&&(n=!0);var i=q(e.id,e.gateway),o=t.state.shouldDisableSubmit;o[i]!==n&&t.setState({shouldDisableSubmit:(0,a.__assign)((0,a.__assign)({},o),(r={},r[i]=n,r))})},t.hidePaymentSubmitButton=function(e,n){var r;void 0===n&&(n=!0);var i=q(e.id,e.gateway),o=t.state.shouldHidePaymentSubmitButton;o[i]!==n&&t.setState({shouldHidePaymentSubmitButton:(0,a.__assign)((0,a.__assign)({},o),(r={},r[i]=n,r))})},t.handleBeforeUnload=function(e){var n=t.props,a=n.defaultMethod,r=n.isSubmittingOrder,i=n.language,o=t.state.selectedMethod,d=void 0===o?a:o;if(r&&d&&d.type!==le.Hosted&&d.type!==le.PPSDK&&d.gateway!==J.A.BlueSnapDirect&&d.gateway!==J.A.BlueSnapV2&&d.id!==J.A.AmazonPay&&d.id!==J.A.CBAMPGS&&d.id!==J.A.Checkoutcom&&d.id!==J.A.CheckoutcomGooglePay&&d.id!==J.A.Converge&&d.id!==J.A.Humm&&d.id!==J.A.Laybuy&&d.id!==J.A.Opy&&d.id!==J.A.Quadpay&&d.id!==J.A.SagePay&&d.id!==J.A.Sezzle&&d.id!==J.A.WorldpayAccess&&d.id!==J.A.Zip&&d.gateway!==J.A.AdyenV2&&d.gateway!==J.A.AdyenV2GooglePay&&d.gateway!==J.A.AdyenV3&&d.gateway!==J.A.AdyenV3GooglePay&&d.gateway!==J.A.Afterpay&&d.gateway!==J.A.Clearpay&&d.gateway!==J.A.Checkoutcom&&d.gateway!==J.A.Mollie&&d.gateway!==J.A.StripeV3){var s=i.translate("common.leave_warning");return e.returnValue=s,s}},t.handleCloseModal=function(e,n){return(0,a.__awaiter)(t,[e,n],void 0,(function(e,t){var n,r,i,o,d,s,l,c,m,p=t.error;return(0,a.__generator)(this,(function(e){switch(e.label){case 0:return p?(n=this.props,r=n.cartUrl,i=n.clearError,o=n.loadCheckout,"provider_fatal_error"!==(d=p.type)&&"order_could_not_be_finalized_error"!==d||window.location.replace(r||"/"),"tax_provider_unavailable"===d&&window.location.reload(),"cart_consistency"!==d?[3,2]:[4,o()]):[2];case 1:e.sent(),e.label=2;case 2:return(0,u.A)(p)&&p.body?(s=p.body,l=p.headers,c=p.status,"provider_error"===s.type&&l.location&&(null===(m=window.top)||void 0===m||m.location.assign(l.location)),429!==c&&"spam_protection_expired"!==s.type&&"spam_protection_failed"!==s.type?[3,4]:(this.setState({didExceedSpamLimit:!0}),[4,o()])):[3,4];case 3:e.sent(),e.label=4;case 4:return i(p),[2]}}))}))},t.handleStoreCreditChange=function(e){return(0,a.__awaiter)(t,void 0,void 0,(function(){var t,n,r,o,d;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:t=this.props,n=t.applyStoreCredit,r=t.onUnhandledError,o=void 0===r?i.noop:r,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,n(e)];case 2:return a.sent(),[3,4];case 3:return d=a.sent(),o(d),[3,4];case 4:return[2]}}))}))},t.handleError=function(e){var n=t.props,a=n.onUnhandledError,r=void 0===a?i.noop:a,o=n.errorLogger;if("unexpected_detachment"!==e.type)return r(e);o.log(e)},t.handleSubmit=function(e){return(0,a.__awaiter)(t,void 0,void 0,(function(){var t,n,r,o,d,s,l,c,m,p,y,h,_,v,f,g,b,E,C,S;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:if(t=this.props,n=t.defaultMethod,r=t.loadPaymentMethods,o=t.isPaymentDataRequired,d=t.onCartChangedError,s=void 0===d?i.noop:d,l=t.onSubmit,c=void 0===l?i.noop:l,m=t.onSubmitError,p=void 0===m?i.noop:m,y=t.submitOrder,h=t.analyticsTracker,_=this.state,v=_.selectedMethod,f=void 0===v?n:v,g=_.submitFunctions,h.clickPayButton({shouldCreateAccount:e.shouldCreateAccount}),b=f&&g[q(f.id,f.gateway)])return[2,b(e)];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,y(V(e,o()))];case 2:return E=a.sent(),C=E.data.getOrder(),h.paymentComplete(),c(null==C?void 0:C.orderId),[3,4];case 3:return S=a.sent(),h.paymentRejected(),(0,u.A)(S)&&"payment_method_invalid"===S.type?[2,r()]:"cart_changed"===S.type?[2,s(S)]:(p(S),[3,4]);case 4:return[2]}}))}))},t.setSelectedMethod=function(e){t.state.selectedMethod!==e&&(e&&t.trackSelectedPaymentMethod(e),t.setState({selectedMethod:e}))},t.setSubmit=function(e,n){var r,i=q(e.id,e.gateway),o=t.state.submitFunctions;o[i]!==n&&t.setState({submitFunctions:(0,a.__assign)((0,a.__assign)({},o),(r={},r[i]=n,r))})},t.setValidationSchema=function(e,n){var r,i=q(e.id,e.gateway),o=t.state.validationSchemas;o[i]!==n&&t.setState({validationSchemas:(0,a.__assign)((0,a.__assign)({},o),(r={},r[i]=n,r))})},t}return(0,a.__extends)(t,e),t.prototype.componentDidMount=function(){return(0,a.__awaiter)(this,void 0,void 0,(function(){var e,t,n,r,o,d,s,l,c,m,p,y,h,_=this;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:return e=this.props,t=e.finalizeOrderIfNeeded,n=e.onFinalize,r=void 0===n?i.noop:n,o=e.onFinalizeError,d=void 0===o?i.noop:o,s=e.onReady,l=void 0===s?i.noop:s,c=e.usableStoreCredit,m=e.checkoutServiceSubscribe,c&&this.handleStoreCreditChange(!0),[4,this.loadPaymentMethodsOrThrow()];case 1:a.sent(),a.label=2;case 2:return a.trys.push([2,4,,5]),[4,t()];case 3:return p=a.sent(),y=p.data.getOrder(),r(null==y?void 0:y.orderId),[3,5];case 4:return h=a.sent(),(0,u.A)(h)&&"order_finalization_not_required"!==h.type&&d(h),[3,5];case 5:return this.grandTotalChangeUnsubscribe=m((function(){return _.handleCartTotalChange()}),(function(e){var t;return null===(t=e.data.getCheckout())||void 0===t?void 0:t.grandTotal}),(function(e){var t;return null===(t=e.data.getCheckout())||void 0===t?void 0:t.outstandingBalance})),window.addEventListener("beforeunload",this.handleBeforeUnload),this.setState({isReady:!0}),l(),[2]}}))}))},t.prototype.componentDidUpdate=function(){var e=this.props,t=e.checkEmbeddedSupport;(void 0===t?i.noop:t)(e.methods.map((function(e){return e.id})))},t.prototype.componentWillUnmount=function(){this.grandTotalChangeUnsubscribe&&(this.grandTotalChangeUnsubscribe(),this.grandTotalChangeUnsubscribe=void 0),window.removeEventListener("beforeunload",this.handleBeforeUnload)},t.prototype.render=function(){var e=this.props,t=e.defaultMethod,n=(e.finalizeOrderError,e.isInitializingPayment),r=e.isUsingMultiShipping,d=e.methods,l=(e.applyStoreCredit,(0,a.__rest)(e,["defaultMethod","finalizeOrderError","isInitializingPayment","isUsingMultiShipping","methods","applyStoreCredit"])),c=this.state,u=c.didExceedSpamLimit,m=c.isReady,p=c.selectedMethod,y=void 0===p?t:p,h=c.shouldDisableSubmit,_=c.validationSchemas,v=c.shouldHidePaymentSubmitButton,f=y&&q(y.id,y.gateway);return o.createElement(F.Provider,{value:this.getContextValue()},o.createElement(s.A,{isLoading:!m},!(0,i.isEmpty)(d)&&t&&o.createElement(de,(0,a.__assign)({},l,{defaultGatewayId:t.gateway,defaultMethodId:t.id,didExceedSpamLimit:u,isInitializingPayment:n,isUsingMultiShipping:r,isPaymentDataRequired:function(){return!1},methods:d,onMethodSelect:this.setSelectedMethod,onStoreCreditChange:this.handleStoreCreditChange,onSubmit:this.handleSubmit,onUnhandledError:this.handleError,selectedMethod:y,shouldDisableSubmit:f&&h[f]||void 0,shouldHidePaymentSubmitButton:f&&l.isPaymentDataRequired()&&v[f]||void 0,validationSchema:f&&_[f]||void 0}))),this.renderOrderErrorModal(),this.renderEmbeddedSupportErrorModal())},t.prototype.renderOrderErrorModal=function(){var e=this.props,t=e.finalizeOrderError,n=e.language,a=e.shouldLocaliseErrorMessages,r=e.submitOrderError||t;return r&&"order_finalization_not_required"!==r.type&&"payment_cancelled"!==r.type&&"payment_invalid_form"!==r.type&&"spam_protection_not_completed"!==r.type&&"invalid_hosted_form_value"!==r.type?o.createElement(m.A,{error:r,message:I(r,n.translate.bind(n),a),onClose:this.handleCloseModal,title:D(r,n.translate.bind(n))}):null},t.prototype.renderEmbeddedSupportErrorModal=function(){var e=this.props,t=e.checkEmbeddedSupport,n=void 0===t?i.noop:t,a=e.methods;try{n(a.map((function(e){return e.id})))}catch(e){if(e instanceof Error)return o.createElement(m.A,{error:e,onClose:this.handleCloseModal})}return null},t.prototype.trackSelectedPaymentMethod=function(e){var t=this.props.analyticsTracker,n=e.config.displayName||e.id,a=e.id;t.selectedPaymentMethod(n,a)},t.prototype.loadPaymentMethodsOrThrow=function(){return(0,a.__awaiter)(this,void 0,void 0,(function(){var e,t,n,r,o,d;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:e=this.props,t=e.loadPaymentMethods,n=e.onUnhandledError,r=void 0===n?i.noop:n,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,t()];case 2:return a.sent(),(o=this.state.selectedMethod||this.props.defaultMethod)&&this.trackSelectedPaymentMethod(o),[3,4];case 3:return d=a.sent(),r(d),[3,4];case 4:return[2]}}))}))},t.prototype.handleCartTotalChange=function(){return(0,a.__awaiter)(this,void 0,void 0,(function(){return(0,a.__generator)(this,(function(e){switch(e.label){case 0:return this.state.isReady?(this.setState({isReady:!1}),[4,this.loadPaymentMethodsOrThrow()]):[2];case 1:return e.sent(),this.setState({isReady:!0}),[2]}}))}))},t}(o.Component);function ue(e){var t=e.checkoutService,n=e.checkoutState,a=n.data,r=a.getCheckout,o=a.getConfig,d=a.getCustomer,s=a.getConsignments,l=a.getOrder,c=a.getPaymentMethod,u=a.getPaymentMethods,m=a.isPaymentDataRequired,y=a.getPaymentProviderCustomer,h=n.errors,_=h.getFinalizeOrderError,v=h.getSubmitOrderError,f=n.statuses,g=f.isInitializingPayment,b=f.isSubmittingOrder,E=r(),C=o(),S=d(),A=s(),P=y(),w=(l()||{}).isComplete,k=void 0!==w&&w,M=u()||p.M;if(null==P?void 0:P.stripeLinkAuthenticationState){var T=M.filter((function(e){return"card"===e.id&&e.gateway===J.A.StripeUPE}));M=T.length?T:M}if(!E||!C||!S||k)return null;var O,z,N=C.checkoutSettings,I=N.enableTermsAndConditions,D=N.features,R=N.orderTermsAndConditionsType,B=N.orderTermsAndConditions,q=N.orderTermsAndConditionsLink,U=I,L=(0,i.find)(E.payments,{providerType:le.Hosted}),V=E.isStoreCreditApplied;if(z=M.filter((function(e){return e.id===J.A.Bolt&&e.initializationData?!!e.initializationData.showInCheckout:e.id!==J.A.BraintreeLocalPaymentMethod})),A&&A.length>1){var F=[J.A.AmazonPay];z=M.filter((function(e){return-1===F.indexOf(e.id)}))}return L?z=(O=c(L.providerId,L.gatewayId))?(0,i.compact)([O]):z:O=(0,i.find)(z,{config:{hasDefaultStoredInstrument:!0}}),{applyStoreCredit:t.applyStoreCredit,availableStoreCredit:S.storeCredit,cartUrl:C.links.cartLink,clearError:t.clearError,defaultMethod:O||z[0],finalizeOrderError:_(),finalizeOrderIfNeeded:t.finalizeOrderIfNeeded,loadCheckout:t.loadCheckout,isInitializingPayment:g(),isPaymentDataRequired:m,isStoreCreditApplied:V,isSubmittingOrder:b(),isTermsConditionsRequired:U,loadPaymentMethods:t.loadPaymentMethods,methods:z,shouldExecuteSpamCheck:E.shouldExecuteSpamCheck,shouldLocaliseErrorMessages:D["PAYMENTS-6799.localise_checkout_payment_error_messages"],submitOrder:t.submitOrder,submitOrderError:v(),checkoutServiceSubscribe:t.subscribe,termsConditionsText:U&&R===x.TextArea?B:void 0,termsConditionsUrl:U&&R===x.Link?q:void 0,usableStoreCredit:E.grandTotal>0?Math.min(E.grandTotal,S.storeCredit||0):0}}const me=(0,l.A)((0,d.A)((0,c.A)(ue)(ce)))},91589:(e,t,n)=>{n.d(t,{A:()=>i});var a=n(31635),r=n(30455);const i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={isOpen:!1},t.canHandleEvent=!1,t.handleOpen=function(){t.canHandleEvent&&t.setState({isOpen:!0})},t.handleClose=function(){t.canHandleEvent&&t.setState({isOpen:!1})},t.handleKeyOpen=function(e){"Enter"===e.key&&t.handleOpen()},t}return(0,a.__extends)(t,e),t.prototype.componentDidMount=function(){this.canHandleEvent=!0},t.prototype.componentWillUnmount=function(){this.canHandleEvent=!1},t.prototype.render=function(){var e=this.props,t=e.children,n=e.modal,a=this.state.isOpen;return r.createElement(r.Fragment,null,t({onClick:this.handleOpen,onKeyPress:this.handleKeyOpen}),n({isOpen:a,onRequestClose:this.handleClose}))},t}(r.Component)}}]);
//# sourceMappingURL=payment-88f092c8.js.map